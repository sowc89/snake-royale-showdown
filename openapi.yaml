openapi: 3.1.0
info:
  title: Snake Royale Showdown API
  version: 1.0.0
  description: "OpenAPI specification for the Snake Royale Showdown backend. This spec models the mocked frontend service layer and will be used to implement the real backend later."
servers:
  - url: https://api.example.com
    description: Production server
  - url: http://localhost:4000
    description: Local development server
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
        username:
          type: string
        email:
          type: string
      required:
        - id
        - username
        - email
    AuthRequest:
      type: object
      properties:
        email:
          type: string
          format: email
        password:
          type: string
      required:
        - email
        - password
    SignupRequest:
      allOf:
        - $ref: '#/components/schemas/AuthRequest'
        - type: object
          properties:
            username:
              type: string
          required:
            - username
    AuthResponse:
      type: object
      properties:
        user:
          $ref: '#/components/schemas/User'
        token:
          type: string
      required:
        - user
        - token
    GameMode:
      type: object
      properties:
        id:
          type: string
          enum: ["pass-through","walls"]
        name:
          type: string
        description:
          type: string
      required: [id,name,description]
    GameResult:
      type: object
      properties:
        id:
          type: string
        player1:
          type: string
        player2:
          type: string
        winner:
          type: string
        player1Score:
          type: integer
        player2Score:
          type: integer
        mode:
          type: string
          enum: ["pass-through","walls"]
        duration:
          type: integer
        timestamp:
          type: integer
      required: [id,player1,player2,winner,player1Score,player2Score,mode,duration,timestamp]
    SaveGameResultRequest:
      type: object
      properties:
        player1:
          type: string
        player2:
          type: string
        winner:
          type: string
        player1Score:
          type: integer
        player2Score:
          type: integer
        mode:
          type: string
          enum: ["pass-through","walls"]
        duration:
          type: integer
      required: [player1,player2,winner,player1Score,player2Score,mode,duration]
    LeaderboardEntry:
      type: object
      properties:
        rank:
          type: integer
        username:
          type: string
        wins:
          type: integer
        totalGames:
          type: integer
        highestScore:
          type: integer
        winRate:
          type: number
      required: [rank,username,wins,totalGames,highestScore,winRate]
    LiveGame:
      type: object
      properties:
        id:
          type: string
        player1:
          type: string
        player2:
          type: string
        player1Score:
          type: integer
        player2Score:
          type: integer
        mode:
          type: string
          enum: ["pass-through","walls"]
        timeRemaining:
          type: integer
        player1Alive:
          type: boolean
        player2Alive:
          type: boolean
      required: [id,player1,player2,player1Score,player2Score,mode,timeRemaining,player1Alive,player2Alive]
    GameRoom:
      type: object
      properties:
        id:
          type: string
        hostUsername:
          type: string
        mode:
          type: string
          enum: ["pass-through","walls"]
        status:
          type: string
          enum: ["waiting","in-progress","finished"]
        players:
          type: array
          items:
            type: string
        maxPlayers:
          type: integer
      required: [id,hostUsername,mode,status,players,maxPlayers]
    CreateRoomRequest:
      type: object
      properties:
        hostUsername:
          type: string
        mode:
          type: string
          enum: ["pass-through","walls"]
      required: [hostUsername,mode]
    JoinRoomRequest:
      type: object
      properties:
        username:
          type: string
      required: [username]
paths:
  /auth/login:
    post:
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AuthRequest'
      responses:
        '200':
          description: Successful login
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          description: Invalid credentials
  /auth/signup:
    post:
      summary: Signup new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SignupRequest'
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '400':
          description: Email already exists
  /auth/logout:
    post:
      summary: Logout user
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Logged out
  /auth/me:
    get:
      summary: Get current user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          description: Not authenticated
  /modes:
    get:
      summary: Get available game modes
      responses:
        '200':
          description: Array of game modes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GameMode'
  /games/results:
    post:
      summary: Save game result
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SaveGameResultRequest'
      responses:
        '201':
          description: Created game result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameResult'
  /leaderboard:
    get:
      summary: Get leaderboard
      responses:
        '200':
          description: Leaderboard entries
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LeaderboardEntry'
  /live-games:
    get:
      summary: Get live games
      responses:
        '200':
          description: Live games
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/LiveGame'
  /rooms:
    post:
      summary: Create a game room
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateRoomRequest'
      responses:
        '201':
          description: Created room
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameRoom'
  /rooms/{roomId}:
    get:
      summary: Get room details
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Game room
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameRoom'
        '404':
          description: Room not found
    post:
      summary: Start game in room
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        description: (no body required)
      responses:
        '204':
          description: Game started
  /rooms/{roomId}/join:
    post:
      summary: Join a room
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinRoomRequest'
      responses:
        '200':
          description: Joined room
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/GameRoom'
        '400':
          description: Bad request / room full / already in room
  /rooms/{roomId}/leave:
    post:
      summary: Leave a room
      parameters:
        - name: roomId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/JoinRoomRequest'
      responses:
        '204':
          description: Left room

security:
  - bearerAuth: []
